# 模具曲面精度分析系统 - 功能详细说明

## 🎯 核心功能模块

### 1. 理论数据管理
- **数据加载**: 支持CSV格式理论点云数据加载
- **数据格式**: 要求包含 x_mm, y_mm, z_mm 列的坐标数据  
- **数据验证**: 自动验证数据完整性和格式正确性
- **界面反馈**: 显示加载成功状态和数据点数量

### 2. 硬件测量模拟系统

#### 测量模拟器 (HardwareSimulator)
- **模拟机制**: 
  - 基于理论点云数据生成测量点
  - 循环旋转模式模拟真实硬件测量轨迹
  - 添加系统误差、随机噪声、位置相关误差
- **误差模型**:
  - 系统性误差: 固定偏移 ±0.02mm
  - 随机噪声: 高斯分布，σ=0.05mm
  - 角度相关误差: 基于位置的周期性变化
- **数据输出**: 实时写入CSV文件 (live_measurement.csv)

#### 测量参数控制
- **X轴范围**: 可设置测量起始和结束位置
- **步长控制**: X轴步长和旋转角度步长独立设置
- **测量速度**: 可调节测量间隔时间
- **进度监控**: 实时显示测量进度和剩余点数

### 3. 实时误差分析系统

#### 误差分析器 (AnalysisWorker)
- **文件监控**: 实时监控测量数据文件变化
- **坐标转换**: 柱坐标与笛卡尔坐标精确转换
- **误差计算**:
  - 半径误差计算
  - 位置误差分析  
  - 角度偏差统计
- **统计分析**:
  - 最大/最小/平均误差
  - 标准差和方差
  - 合格率统计

#### 查找算法优化
- **理论数据索引**: 创建高效查找表，O(1)时间复杂度
- **角度量化**: 解决浮点数精度问题
- **缓存机制**: 避免重复计算，提升性能

### 4. 多线程架构

#### 线程分工
```
主线程 (UI Thread)
├── 界面渲染和事件处理
├── 用户交互响应
└── 线程生命周期管理

硬件模拟器线程 
├── 测量点筛选和生成
├── 误差模拟计算
├── 数据文件写入
└── 进度状态报告

误差分析线程
├── 文件变化监控
├── 数据解析处理  
├── 误差计算分析
└── 统计结果更新
```

#### 线程通信
- **信号槽机制**: 线程安全的异步通信
- **数据传递**: 通过信号传递复杂数据结构
- **状态同步**: 实时同步测量状态和进度
- **错误处理**: 线程异常捕获和错误报告

### 5. 数据可视化

#### 3D点云显示
- **理论点云**: 浅蓝色半透明显示
- **测量点**: 绿色实心点显示  
- **实时更新**: 测量过程中动态添加新点
- **视角控制**: 支持旋转、缩放、平移操作

#### 统计图表
- **误差分布直方图**: 
  - 实时更新误差区间分布
  - 颜色编码显示误差等级
  - 英文标签避免乱码问题
- **统计数据面板**:
  - 最大误差、最小误差显示
  - 平均误差和标准差计算
  - 合格率实时统计

### 6. 用户界面交互

#### 测量流程控制
- **开始测量**:
  - 验证理论数据已加载
  - 读取并验证测量参数
  - 创建并启动工作线程
  - 更新界面状态
- **暂停/恢复**: 
  - 线程暂停和恢复控制
  - 状态指示器颜色变化
  - 按钮状态相应切换
- **停止测量**:
  - 安全停止所有线程
  - 清理资源和内存
  - 重置界面状态

#### 实时状态反馈
- **测量进度**: 显示当前点数/总点数和百分比
- **当前位置**: 实时显示X坐标和角度位置
- **状态指示器**: 颜色编码显示系统状态
  - 🟢 绿色: 正在测量
  - 🟡 黄色: 已暂停  
  - 🔴 红色: 已停止
  - ⚪ 灰色: 就绪待机

### 7. 数据管理

#### 文件处理
- **输入文件**: 
  - 支持CSV格式理论点云数据
  - 自动创建 measurement_data 目录
  - 智能文件格式检测
- **输出文件**:
  - live_measurement.csv: 实时测量数据
  - 包含序号、坐标、角度、半径信息
  - 标准CSV格式，便于后续分析

#### 内存管理
- **数据缓存**: 合理的内存使用策略
- **历史记录**: 限制误差历史记录长度(10000点)
- **资源清理**: 测量结束后自动清理线程资源

## 🔧 技术实现特点

### 1. 坐标系统
- **柱坐标系**: (x, angle, radius) 符合测量设备特点
- **笛卡尔坐标**: (x, y, z) 便于3D可视化
- **转换精度**: 使用高精度三角函数确保转换准确性

### 2. 误差模型  
- **物理仿真**: 模拟真实测量设备的误差特性
- **多层次误差**: 系统误差+随机误差+位置误差
- **参数可调**: 误差幅度和特性可通过参数调整

### 3. 性能优化
- **查找索引**: O(1)复杂度的理论点查找
- **增量处理**: 只处理新增的测量数据行
- **内存控制**: 限制数据缓存大小避免内存溢出

### 4. 用户体验
- **响应式设计**: 界面布局自适应窗口大小
- **状态反馈**: 丰富的视觉和文字状态提示
- **异常处理**: 完善的错误捕获和用户提示机制
- **中文界面**: 全中文界面支持，符合国内用户习惯
- **触发方式**: 开始测量后每秒自动执行
- **功能描述**:
  - 生成随机的测量值和理论值
  - 计算误差并确定合格状态
  - 向数据表格添加新行
  - 自动滚动到最新数据
  - 根据状态设置行背景色（超差为黄色）

#### 统计信息更新
- **自动更新内容**:
  - 最大误差、最小误差
  - 平均误差、标准差
  - 实时状态监控（当前 X 位置、旋转角度）
  - 测量进度（已完成点数/总点数）

### 5. 重置视图功能
- **触发方式**: 点击工具栏"🔄 重置视图"按钮
- **功能描述**: 显示重置成功的信息对话框

## 🔧 技术实现特点

### 信号槽连接
- 所有按钮都已连接对应的占位符函数
- 使用 Qt 的信号槽机制实现响应式交互

### 状态管理
- 维护测量状态（开始/暂停/停止）
- 动态启用/禁用相关按钮
- 实时更新状态指示器

### 数据管理
- 维护误差数据列表
- 实时计算统计信息
- 动态更新表格和标签

### 用户体验
- 清晰的控制台输出用于调试
- 友好的消息对话框反馈
- 自动滚动到最新数据
- 颜色编码状态指示

## 🎮 使用方法

1. **启动应用**: `conda activate pyside-env && python app.py`
2. **加载模型**: 点击加载按钮选择 CAD 文件
3. **设置参数**: 在左侧面板调整测量参数
4. **开始测量**: 点击开始按钮观察实时数据生成
5. **控制测量**: 可随时暂停或停止测量过程

## 📋 测试清单

- ✅ 文件对话框正常打开
- ✅ 模型信息正确更新
- ✅ 测量参数读取和验证
- ✅ 按钮状态正确切换
- ✅ 实时数据生成和显示
- ✅ 统计信息自动更新
- ✅ 状态指示器颜色变化
- ✅ 表格自动滚动
- ✅ 错误状态颜色标记
